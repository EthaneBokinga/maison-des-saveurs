<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maisons des douceurs</title>
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome CDN pour ic√¥nes de p√¢tisserie -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Font pour une meilleure lisibilit√© -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <!-- SweetAlert2 CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
</head>
<body>
    <header>
        <h1>
            <img src="assets/images/logo.png" alt="Logo Maisons des douceurs" class="logo-img">
            <span class="brand-name"></span>
          <div id="accountInfo" class="account-info-header" aria-live="polite"></div>
        </h1>
        <button class="hamburger" id="hamburger" onclick="toggleMenu()">
            <i class="fa-solid fa-bars"></i>
        </button>
        <nav id="navMenu">
            <ul>
                <li><a href="#accueil">Acceuil</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#contact">Contact</a></li>
                <li><a href="./assets/admin.html">Administrateur</a></li>
                <li class="cart-icon-container">
                    <button class="cart-btn" onclick="openCart()">
                        <i class="fa-solid fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </button>
                    <div id="miniCart" style="position:absolute; top:100%; right:0;"></div>
                </li>
            </ul>
        </nav>
    </header>

    <!-- Breadcrumb -->
    <div id="breadcrumb" style="max-width:1100px; margin:0 auto; padding:1rem;"></div>

    <section id="accueil" class="hero" style="background-image: url('assets/images/WhatsApp Image 2026-01-06 at 17.20.58.jpeg');">
        <div class="carousel-nav">
          <button class="carousel-btn" onclick="prevHeroSlide()">‚ùÆ</button>
          <div class="carousel-dots" id="carouselDots">
            <span class="carousel-dot active"></span>
            <span class="carousel-dot"></span>
            <span class="carousel-dot"></span>
          </div>
          <button class="carousel-btn" onclick="nextHeroSlide()">‚ùØ</button>
        </div>
        <div class="hero-overlay">
            <h2 class="typing-text" id="typingText"></h2>
            <p>Cr√©ations p√¢tissi√®res sur-mesure, fra√Æches et d√©licieuses ‚Äî g√¢teaux, tartes et plus.</p>
            <a class="btn btn-bounce" href="#services">Voir nos services</a>
        </div>
    </section>

    <!-- Section Filtres & Produits -->
    <div style="max-width:1100px; margin:0 auto; padding:2rem 1rem;">
      <div class="filters-section">
        <div class="filter-group">
          <label>Saveur:</label>
          <select onchange="filterAndSortProducts(this.value, document.getElementById('sortSelect').value)">
            <option value="all">Tous</option>
            <option value="banane">Banane</option>
            <option value="fraise">Fraise</option>
            <option value="vanille">Vanille</option>
            <option value="coco">Coco</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Tri:</label>
          <select id="sortSelect" onchange="filterAndSortProducts(document.querySelector('.filter-group select').value, this.value)">
            <option value="default">D√©faut</option>
            <option value="price-asc">Prix ‚Üë</option>
            <option value="price-desc">Prix ‚Üì</option>
            <option value="popular">Populaire</option>
          </select>
        </div>
        <button class="btn" onclick="openYogurtModal()" style="background:#d35400; color:#fff; border:none; padding:0.8rem 1.5rem; border-radius:8px; cursor:pointer; font-size:1rem; font-weight:700;">üì¶ Modal Yaourts</button>
      </div>
      <div id="productsGridContainer" class="products-grid-container"></div>
      <div id="recommendedProducts" style="margin-top:3rem;"></div>
    </div>
    <!-- Moved to before footer -->

    <section id="services" class="services-section">
        <h2>Nos Services P√¢tisserie</h2>
        <div class="services-grid">
          <article class="service-card" onclick="openYogurtModal()">
            <img src="assets/images/yaourt%20maison.png" alt="Yaourt Maison" class="service-image" />
            <h3>Vente des Yaourts</h3>
            <p>Yaourts frais et d√©licieux avec diff√©rentes saveurs. Cliquez pour d√©couvrir nos produits.</p>
          </article>
            <article class="service-card" onclick="serviceNotAvailable()">
              <img src="assets/images/gateaux.jpg" alt="G√¢teaux personnalis√©s" class="service-image" />
                <h3>G√¢teaux personnalis√©s</h3>
                <p>G√¢teaux pour mariages, anniversaires et √©v√©nements sur-mesure.</p>

            </article>
          <!-- Tartes & Entremets and Viennoiseries removed per request -->
            <article class="service-card" onclick="serviceNotAvailable()">
              <img src="assets/images/traiteur.jpg" alt="Traiteur & √âv√©nementiel" class="service-image" />
                <h3>Traiteur & √âv√©nementiel</h3>
                <p>Buffets sucr√©s, desserts en pi√®ce mont√©e et service sur place.</p>
            </article>
            <article class="service-card" onclick="serviceNotAvailable()">
              <img src="assets/images/atelier.jpg" alt="Ateliers & Cours" class="service-image" />
                <h3>Ateliers & Cours</h3>
                <p>Ateliers pour adultes et enfants, sur r√©servation.</p>
            </article>
            <article class="service-card" onclick="serviceNotAvailable()">
              <img src="assets/images/livraison.jpg" alt="Livraison & Commande" class="service-image" />
                <h3>Livraison & Commande en ligne</h3>
                <p>Commandez en ligne et faites-vous livrer chez vous.</p>
            </article>
            <article class="service-card" onclick="openYogurtModal()">
              <img src="assets/images/yaourt%20maison.png" alt="Yaourt Maison" class="service-image" />
              <h3>Vente des Yaourts</h3>
              <p>Yaourts frais et d√©licieux avec diff√©rentes saveurs. Cliquez pour d√©couvrir nos produits.</p>
            </article>
        </div>
    </section>

    <!-- Modal Yaourts -->
    <div id="yogurtModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeYogurtModal()">&times;</span>
            <h2>Notre S√©lection de Yaourts</h2>
            <div class="yogurt-list">
              <!-- Yaourt Banane -->
              <div class="yogurt-item">
                <div class="yogurt-photo">
                  <img src="assets/images/yaourt%20banane.jpeg" alt="Yaourt Banane">
                </div>
                <div class="yogurt-info">
                  <h4>Yaourt Banane</h4>
                  <p class="yogurt-description">Yaourt banane, saveur douce et naturelle</p>
                  <p class="yogurt-price">450 FCFA</p>
                  <button class="btn wishlist-btn" data-id="yogurt-banane"><i class="fa-regular fa-heart" aria-hidden="true"></i> Favori</button>
                </div>
                <div class="yogurt-controls">
                  <div class="quantity-control">
                    <button class="qty-btn" onclick="decreaseQty(this)">‚àí</button>
                    <input type="number" class="qty-input" value="1" min="1">
                    <button class="qty-btn" onclick="increaseQty(this)">+</button>
                  </div>
                  <button class="btn-add-cart" onclick="addToCart(this)">Ajouter au panier</button>
                </div>
              </div>

              <!-- Yaourt Fraise -->
              <div class="yogurt-item">
                <div class="yogurt-photo">
                  <img src="assets/images/yaourt%20fraise%20.png" alt="Yaourt Fraise">
                </div>
                <div class="yogurt-info">
                  <h4>Yaourt Fraise</h4>
                  <p class="yogurt-description">Yaourt saveur fraise, fruit√© et doux</p>
                  <p class="yogurt-price">450 FCFA</p>
                  <button class="btn wishlist-btn" data-id="yogurt-fraise"><i class="fa-regular fa-heart" aria-hidden="true"></i> Favori</button>

                </div>
                <div class="yogurt-controls">
                  <div class="quantity-control">
                    <button class="qty-btn" onclick="decreaseQty(this)">‚àí</button>
                    <input type="number" class="qty-input" value="1" min="1">
                    <button class="qty-btn" onclick="increaseQty(this)">+</button>
                  </div>
                  <button class="btn-add-cart" onclick="addToCart(this)">Ajouter au panier</button>
                </div>
              </div>

              <!-- Yaourt √† la Vanille -->
              <div class="yogurt-item">
                <div class="yogurt-photo">
                  <img src="assets/images/yaourt%20%C3%A0%20la%20vanille%20.png" alt="Yaourt √† la Vanille">
                </div>
                <div class="yogurt-info">
                  <h4>Yaourt √† la Vanille</h4>
                  <p class="yogurt-description">Yaourt vanille, onctueux et parfum√©</p>
                  <p class="yogurt-price">450 FCFA</p>
            <button class="btn wishlist-btn" data-id="yogurt-vanille"><i class="fa-regular fa-heart" aria-hidden="true"></i> Favori</button>

                </div>
                <div class="yogurt-controls">
                  <div class="quantity-control">
                    <button class="qty-btn" onclick="decreaseQty(this)">‚àí</button>
                    <input type="number" class="qty-input" value="1" min="1">
                    <button class="qty-btn" onclick="increaseQty(this)">+</button>
                  </div>
                  <button class="btn-add-cart" onclick="addToCart(this)">Ajouter au panier</button>
                </div>
              </div>

              <!-- Yaourt Coco -->
              <div class="yogurt-item">
                <div class="yogurt-photo">
                  <img src="assets/images/yaourt%20%20coco.png" alt="Yaourt Coco">
                </div>
                <div class="yogurt-info">
                  <h4>Yaourt Coco</h4>
                  <p class="yogurt-description">Yaourt parfum coco, onctueux et frais</p>
                  <p class="yogurt-price">450 FCFA</p>
            <button class="btn wishlist-btn" data-id="yogurt-coco"><i class="fa-regular fa-heart" aria-hidden="true"></i> Favori</button>

                </div>
                <div class="yogurt-controls">
                  <div class="quantity-control">
                    <button class="qty-btn" onclick="decreaseQty(this)">‚àí</button>
                    <input type="number" class="qty-input" value="1" min="1">
                    <button class="qty-btn" onclick="increaseQty(this)">+</button>
                  </div>
                  <button class="btn-add-cart" onclick="addToCart(this)">Ajouter au panier</button>
                </div>
              </div>
            </div>
        </div>
    </div>

    <!-- Modal Panier -->
    <div id="cartModal" class="modal">
        <div class="modal-content cart-modal-content">
            <span class="modal-close" onclick="closeCart()">&times;</span>
            <h2><i class="fa-solid fa-shopping-cart"></i> Mon Panier</h2>
            <div class="cart-items" id="cartItems">
                <p class="empty-cart">Votre panier est vide</p>
            </div>
            <div class="cart-summary">
                <div class="summary-row">
                    <span>Sous-total :</span>
                    <span id="subtotal">0 FCFA</span>
                </div>
                <div class="summary-row">
                    <span>Frais de livraison :</span>
                    <span id="shipping">0 FCFA</span>
                </div>
                <div class="summary-row total">
                    <span>Total :</span>
                    <span id="total">0 FCFA</span>
                </div>
            </div>
            <div class="cart-actions">
                <button class="btn-secondary" onclick="closeCart()">Continuer les courses</button>
                <button class="btn" id="checkoutBtn" onclick="checkout()" style="display:none;">Finaliser le paiement</button>
            </div>
        </div>
    </div>

    <section id="contact" class="contact-section">
        <h2>Contactez-nous</h2>
        <div class="contact-grid">
            <div id="contactFormContainer">
                <form id="contactForm" action="/send" method="POST" novalidate>
                    <!-- Honeypot anti-bot : laisser vide pour les utilisateurs r√©els -->
                    <input type="text" name="website" id="website" class="honeypot" autocomplete="off" tabindex="-1">

                    <label for="name">Nom complet </label>
                    <input type="text" id="name" name="name" required maxlength="100" required="">

                    <label for="email">E-mail </label>
                    <input type="email" id="email" name="email" required>

                    <label for="phone">T√©l√©phone</label>
                    <input type="tel" id="phone" name="phone" pattern="^[0-9+()\-\s]{6,20}$">

                    <label for="date">Date de l'√©v√©nement (optionnel)</label>
                    <input type="date" id="date" name="date">

                    <label for="message">Message </label>
                    <textarea id="message" name="message" rows="5" required maxlength="2000" style="resize: none;"></textarea>

                    <div class="form-buttons">
                      <button class="btn" type="submit">Envoyer</button>
                      <button type="button" class="btn btn-secondary" id="reportIssueBtn">Signaler un probl√®me</button>
                    </div>
                    <p class="form-note">Nous allons vous r√©pondre dans les bref d√©lais</p>
                </form>
            </div>
            <div class="contact-info">
                <h3>Contact rapide</h3>
                <p>
                  <button class="whatsapp-btn" onclick="openWhatsApp('Bonjour, je voudrai des informations sur vos yaourts');"><i class="fa-brands fa-whatsapp" aria-hidden="true"></i> Chat WhatsApp</button>
                </p>
                <p><i class="fa-solid fa-envelope" aria-hidden="true"></i><a href="soisegallouo@gmail.com">soisegallouo@gmail.com</a></p>
                <p><i class="fa-solid fa-location-dot" aria-hidden="true"></i> 86 Rue massa talagai, Brazzaville</p>
            </div>
        </div>
    </section>

    <!-- Section Newsletter -->
    <div style="max-width:1100px; margin:0 auto; padding:1rem;">
      <div class="newsletter-section">
        <div style="display:flex; align-items:center; gap:0.5rem; justify-content:center; flex-wrap:wrap;">
          <h3 style="margin:0;">üì¨ Inscrivez-vous √† notre Newsletter</h3>
          <button type="button" class="info-button" title="C'est quoi la newsletter?" onclick="showNewsletterInfo()" style="background:none; border:none; cursor:pointer; font-size:1.3rem; color:#d35400; padding:0; width:30px; height:30px; display:flex; align-items:center; justify-content:center; border-radius:50%; transition:all 0.3s ease;" onmouseover="this.style.background='rgba(211,84,0,0.1)'; this.style.transform='scale(1.15)';" onmouseout="this.style.background='none'; this.style.transform='scale(1)';">‚ÑπÔ∏è</button>
        </div>
        <p>Recevez 20% de r√©duction sur votre premi√®re commande !</p>
        <div class="newsletter-form">
          <input type="email" id="newsletterEmail" placeholder="Votre email...">
          <button onclick="subscribeNewsletter()">S'abonner</button>
        </div>
      </div>
    </div>

    <!-- Bouton Historique Commandes -->
    <div style="max-width:1100px; margin:0 auto; padding:1rem; text-align:center;">
      <button class="btn" onclick="showOrderHistory()" style="background:#27ae60; color:#fff; border:none; padding:0.8rem 1.5rem; border-radius:8px; cursor:pointer; font-size:1rem; font-weight:700;">üìã Mes Commandes</button>
    </div>

    <!-- Modal Historique Commandes -->
    <div id="orderHistoryModal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:800px;">
        <span class="modal-close" onclick="document.getElementById('orderHistoryModal').style.display='none'">&times;</span>
        <h2>üìã Historique de mes Commandes</h2>
        <div id="orderHistoryContent"></div>
      </div>
    </div>

    <!-- Reviews section moved before footer -->
    <section id="reviews" class="reviews-section">
      <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
        <h2 style="margin:0;">Avis des Clients</h2>
        <button id="resetReviewsBtn" onclick="resetAllReviews()" style="background:#ff6b6b; color:#fff; border:none; padding:0.6rem 1rem; border-radius:6px; cursor:pointer; font-size:0.9rem; display:none;">üîÑ R√©initialiser tous les avis</button>
      </div>
      <div id="averageRating"></div>
      <div class="reviews-filter">
        <button class="active" onclick="filterReviews('all'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">Tous</button>
        <button onclick="filterReviews('5'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</button>
        <button onclick="filterReviews('4'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">‚≠ê‚≠ê‚≠ê‚≠ê</button>
        <button onclick="filterReviews('3'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">‚≠ê‚≠ê‚≠ê</button>
        <button onclick="filterReviews('12'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">‚¨á 2 ‚≠ê</button>
      </div>
      <div id="reviewsList" class="reviews-list">
        <!-- Reviews will be rendered here -->
      </div>
      <div id="reviewFormContainer" class="review-form-container">
        <h3>Donner un Avis</h3>
        <div id="notLoggedReview" class="not-logged-msg">Veuillez vous connecter pour poster un avis.</div>
        <form id="reviewForm" style="display:none;">
          <div class="review-form-group">
            <label for="reviewRating">Votre note</label>
            <select id="reviewRating" class="review-rating-select">
              <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent</option>
              <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Tr√®s bien</option>
              <option value="3">‚≠ê‚≠ê‚≠ê Bien</option>
              <option value="2">‚≠ê‚≠ê Moyen</option>
              <option value="1">‚≠ê Mauvais</option>
            </select>
          </div>
          <div class="review-form-group">
            <label for="reviewComment">Votre avis</label>
            <textarea id="reviewComment" rows="4" maxlength="500" placeholder="Partagez votre exp√©rience..."></textarea>
          </div>
          <button type="button" class="btn" id="submitReviewBtn">Poster mon avis</button>
        </form>
      </div>
    </section>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h4>üç∞ Delice Royal</h4>
                <p>Bienvenue chez Maisons des saveurs, votre destination pour des yaourts artisanaux et des p√¢tisseries exquisites.</p>
                <div class="social">
                    <a href="https://wa.me/242064965598?text=Bonjour%20Delice%20Royal" aria-label="WhatsApp" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp"></i></a>
                    <a href="mailto:soisegallouo@gmail.com" aria-label="Email"><i class="fa-solid fa-envelope"></i></a>
                    <a href="tel:+242064965598" aria-label="T√©l√©phone"><i class="fa-solid fa-phone"></i></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h4>üìç Nous Trouver</h4>
                <p><strong>Adresse:</strong><br>86 Rue Massa Talagai<br>Brazzaville, Congo</p>
                <p><strong>Email:</strong><br><a href="mailto:soisegallouo@gmail.com">soisegallouo@gmail.com</a></p>
            </div>
            
            <div class="footer-section">
                <h4>‚è∞ Horaires</h4>
                <p><strong>Lundi - Vendredi</strong><br>8h00 - 18h00</p>
                <p><strong>Samedi - Dimanche</strong><br>9h00 - 17h00</p>
                <p style="margin-top: 1rem; color: #ffa500; font-weight: 700;">Livraison gratuite pour commandes > 50,000 FCFA</p>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2026 Delice Royal - Maisons des Saveurs. Tous droits r√©serv√©s.</p>
            <p>Fait avec ‚ù§Ô∏è pour vos moments sucr√©s</p>
        </div>
    </footer>

    <!-- Scripts: validation client-side et pr√©vention des bots (toujours effectuer validation c√¥t√© serveur) -->    <!-- Scroll to Top Button -->
    <button id="scrollTopBtn" onclick="scrollToTop()" title="Haut de la page">‚Üë</button>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <script src="assets/js/features.js"></script>
    <script>
    // Animation du texte : on conserve "Bienvenue chez Maisons des" et
    // n'anime que le mot color√© (ex: 'douceurs').
    const typingTextElement = document.getElementById('typingText');
    const dynamicWords = ['douceurs', 'd√©lices', 'saveurs'];
    let dwIndex = 0;
    let charIndex = 0;
    let deleting = false;

    function typeText() {
      // initialise le texte fixe + span vide pour le mot anim√©
      const mainText = 'Bienvenue chez Maisons des ';
      if (!typingTextElement.querySelector('#dynamic-word')) {
        typingTextElement.innerHTML = mainText + '<span id="dynamic-word" style="color: #d35400;"></span>';
      }
    }

    function animateDynamicWord() {
      const span = document.getElementById('dynamic-word');
      const word = dynamicWords[dwIndex];
      if (!deleting) {
        if (charIndex < word.length) {
          charIndex++;
          span.textContent = word.substring(0, charIndex);
          setTimeout(animateDynamicWord, 90);
        } else {
          // pause plein mot
          setTimeout(() => { deleting = true; animateDynamicWord(); }, 1400);
        }
      } else {
        if (charIndex > 0) {
          charIndex--;
          span.textContent = word.substring(0, charIndex);
          setTimeout(animateDynamicWord, 60);
        } else {
          deleting = false;
          dwIndex = (dwIndex + 1) % dynamicWords.length;
          setTimeout(animateDynamicWord, 400);
        }
      }
    }

    // Menu hamburger
    function toggleMenu() {
        const navMenu = document.getElementById('navMenu');
        const hamburger = document.getElementById('hamburger');
        navMenu.classList.toggle('active');
        hamburger.classList.toggle('active');
    }

    // Fermer le menu quand on clique sur un lien
    document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('#navMenu a');
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                document.getElementById('navMenu').classList.remove('active');
                document.getElementById('hamburger').classList.remove('active');
            });
        });
    });

    // Initialiser le panier depuis le localStorage (GLOBAL)
    window.cart = JSON.parse(localStorage.getItem('cart')) || [];

    // Sauvegarder le panier
    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(window.cart));
      updateCartCount();
    }

    // Mettre √† jour le compteur du panier (GLOBAL)
    window.updateCartCount = function() {
      const count = (window.cart || []).reduce((total, item) => total + item.quantity, 0);
      const el = document.getElementById('cartCount');
      if (el) el.textContent = count;
    };
    
    // Alias pour la fonction locale
    function updateCartCount() {
      window.updateCartCount();
    }

    // Initialiser le compteur au chargement
    document.addEventListener('DOMContentLoaded', function() {
      updateCartCount();
      updateFavoritesUI();
      typeText(); // D√©marrer l'animation du texte principal
      // Afficher imm√©diatement le premier mot puis lancer l'animation (pause avant effacement)
      const initSpan = document.getElementById('dynamic-word');
      if (initSpan) {
        initSpan.textContent = dynamicWords[0];
        dwIndex = 0;
        charIndex = dynamicWords[0].length;
        deleting = true; // on commencera par effacer apr√®s la pause
        setTimeout(animateDynamicWord, 1400);
      } else {
        setTimeout(animateDynamicWord, 800);
      }

      // V√©rifier la connexion pour le formulaire de contact
      const contactFormContainer = document.getElementById('contactFormContainer');
      if (contactFormContainer) {
        const checkContactAccess = function() {
          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (!currentUser) {
            contactFormContainer.innerHTML = `
              <div style="text-align:center; padding:2rem; background:#fff9e6; border:2px solid #d35400; border-radius:8px;">
                <h3 style="color:#d35400; margin-bottom:1rem;">‚ö†Ô∏è Connexion requise</h3>
                <p style="color:#666; margin-bottom:1.5rem; font-size:1.05rem;">
                  Vous devez cr√©er un compte ou vous connecter pour pouvoir nous contacter.
                </p>
                <div style="display:flex; gap:1rem; justify-content:center; flex-wrap:wrap;">
                  <button class="btn" onclick="window.location.href='login.html'" style="background:#d35400; color:#fff; border:none; padding:0.8rem 1.5rem; border-radius:8px; cursor:pointer; font-size:1rem; font-weight:700;">Se connecter</button>
                  <button class="btn" onclick="window.location.href='register.html'" style="background:#27ae60; color:#fff; border:none; padding:0.8rem 1.5rem; border-radius:8px; cursor:pointer; font-size:1rem; font-weight:700;">Cr√©er un compte</button>
                </div>
              </div>
            `;
          } else {
            // Utilisateur connect√©, afficher le formulaire normalement
            // Le formulaire est d√©j√† dans le HTML, rien √† faire
          }
        };
        checkContactAccess();
      }

      // Validation du formulaire contact
      if (window.setupContactFormListener) {
        window.setupContactFormListener();
      } else {
        const form = document.getElementById('contactForm');
        if (form) {
          form.addEventListener('submit', function (e) {
            if (document.getElementById('website').value.trim() !== '') {
              e.preventDefault();
              return;
            }
            const name = document.getElementById('name');
            const email = document.getElementById('email');
            const message = document.getElementById('message');
            if (!name.value.trim() || !email.value.trim() || !message.value.trim()) {
              e.preventDefault();
              Swal.fire('Erreur', 'Veuillez compl√©ter tous les champs obligatoires.', 'error');
              return;
            }
            e.preventDefault();
            form.reset();
            Swal.fire('Succ√®s', 'Merci ! Votre message a √©t√© envoy√©.', 'success');
          });
        }
      }
    });

    // Gestion des modals yaourts
    function openYogurtModal() {
      document.getElementById('yogurtModal').style.display = 'block';
      // Connecter les boutons favoris
      setTimeout(() => {
        const wishlistBtns = document.querySelectorAll('.wishlist-btn');
        wishlistBtns.forEach(btn => {
          const id = btn.dataset.id;
          // Mettre √† jour la couleur selon si c'est dans les favoris
          if (window.isInFavorites && window.isInFavorites(id)) {
            btn.style.background = '#e74c3c';
            btn.style.color = '#fff';
          } else {
            btn.style.background = '';
            btn.style.color = '';
          }
          btn.onclick = function(e) {
            e.preventDefault();
            const id = this.dataset.id;
            // R√©cup√©rer les donn√©es du produit depuis le DOM
            const container = this.closest('.yogurt-info') || this.closest('.yogurt-item');
            if (container) {
              const name = container.querySelector('h4')?.textContent || '';
              const priceText = container.querySelector('.yogurt-price')?.textContent || '0 FCFA';
              const price = parseInt(priceText) || 0;
              const image = container.closest('.yogurt-item')?.querySelector('img')?.src.split('/').pop() || '';
              addToFavoritesWithData(id, name, price, image);
            } else {
              addToFavorites(id);
            }
          };
        });
      }, 100);
    }

    function closeYogurtModal() {
      document.getElementById('yogurtModal').style.display = 'none';
    }

    // Gestion du panier
    function openCart() {
      displayCart();
      document.getElementById('cartModal').style.display = 'block';
    }
    
    window.openCart = openCart;

    function closeCart() {
      document.getElementById('cartModal').style.display = 'none';
    }

    // Afficher les articles du panier
    function displayCart() {
      const cartItemsDiv = document.getElementById('cartItems');
      const checkoutBtn = document.getElementById('checkoutBtn');

      if (window.cart.length === 0) {
        cartItemsDiv.innerHTML = '<p class="empty-cart">Votre panier est vide</p>';
        checkoutBtn.style.display = 'none';
        document.getElementById('subtotal').textContent = '0 FCFA';
        document.getElementById('shipping').textContent = '0 FCFA';
        document.getElementById('total').textContent = '0 FCFA';
        return;
      }

      let html = '';
      let subtotal = 0;

      window.cart.forEach((item, index) => {
        const itemTotal = item.price * item.quantity;
        subtotal += itemTotal;
        html += `
          <div class="cart-item">
            <div class="cart-item-info">
              <h4>${item.name}</h4>
              <p class="cart-item-price">${item.price} FCFA √ó ${item.quantity}</p>
            </div>
            <div class="cart-item-total">
              <p>${itemTotal} FCFA</p>
              <button class="btn-remove" onclick="removeFromCart(${index})">
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>
          </div>
        `;
      });

      cartItemsDiv.innerHTML = html;
      checkoutBtn.style.display = 'block';

      // Calculer les frais de livraison (10% du sous-total, minimum 2000 FCFA)
      const shipping = Math.max(subtotal * 0.1, 2000);
      const total = subtotal + shipping;

      document.getElementById('subtotal').textContent = subtotal + ' FCFA';
      document.getElementById('shipping').textContent = shipping.toFixed(0) + ' FCFA';
      document.getElementById('total').textContent = total.toFixed(0) + ' FCFA';
    }

    // Retirer du panier
    function removeFromCart(index) {
      Swal.fire({
        title: '√ätes-vous s√ªr ?',
        text: "Voulez-vous retirer cet article du panier ?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d35400',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Oui, retirer',
        cancelButtonText: 'Annuler'
      }).then((result) => {
        if (result.isConfirmed) {
          window.cart.splice(index, 1);
          saveCart();
          displayCart();
          Swal.fire('Supprim√©', 'Article retir√© du panier', 'success');
        }
      });
    }

    // Augmenter la quantit√©
    function increaseQty(btn) {
      const input = btn.parentElement.querySelector('.qty-input');
      input.value = parseInt(input.value) + 1;
    }

    // Diminuer la quantit√©
    function decreaseQty(btn) {
      const input = btn.parentElement.querySelector('.qty-input');
      if (parseInt(input.value) > 1) {
        input.value = parseInt(input.value) - 1;
      }
    }

    // Ajouter au panier
    function addToCart(btn) {
      const yogurtItem = btn.closest('.yogurt-item');
      const name = yogurtItem.querySelector('h4').textContent;
      const quantity = parseInt(yogurtItem.querySelector('.qty-input').value);
      const price = 450;

      // V√©rifier si le produit existe d√©j√†
      const existingItem = window.cart.find(item => item.name === name);
      if (existingItem) {
        existingItem.quantity += quantity;
      } else {
        window.cart.push({
          name: name,
          price: price,
          quantity: quantity
        });
      }

      saveCart();

      // SweetAlert2 pour la confirmation
      Swal.fire({
        position: 'top-end',
        icon: 'success',
        title: 'Ajout√© au panier',
        html: `<strong>${quantity}x ${name}</strong><br/>(${price * quantity} FCFA)`,
        showConfirmButton: false,
        timer: 2000,
        timerProgressBar: true,
        toast: true
      });

      // R√©initialiser la quantit√©
      yogurtItem.querySelector('.qty-input').value = 1;
    }

    // Service non disponible
    function serviceNotAvailable() {
      Swal.fire({
        icon: 'info',
        title: 'Service non disponible',
        text: 'Ce service sera bient√¥t disponible. Veuillez revenir plus tard !',
        confirmButtonColor: '#d35400'
      });
    }

    // Finaliser le paiement
    function checkout() {
      // V√©rifier si l'utilisateur est connect√©
      const currentUserEmail = localStorage.getItem('currentUser');
      if (!currentUserEmail) {
        Swal.fire({
          icon: 'warning',
          title: 'Connexion requise',
          text: 'Vous devez √™tre connect√© pour finaliser une commande.',
          showCancelButton: true,
          confirmButtonText: 'Se connecter',
          cancelButtonText: 'Annuler'
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = 'login.html';
          }
        });
        return;
      }
      const total = document.getElementById('total').textContent;
      Swal.fire({
        title: 'Confirmer la commande',
        html: `<p>Montant total : <strong>${total}</strong></p><p>Veuillez confirmer votre commande. Nos √©quipes vous contactera sous peu.</p>`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#d35400',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Confirmer',
        cancelButtonText: 'Annuler'
      }).then((result) => {
        if (result.isConfirmed) {
          // R√©cup√©rer les infos du client
          Swal.fire({
            title: 'Informations de livraison',
            html: `
              <input type="text" id="swal-name" class="swal2-input" placeholder="Votre nom">
              <input type="tel" id="swal-phone" class="swal2-input" placeholder="Votre t√©l√©phone">
              <label style="text-align:left; width:100%; font-weight:600; margin-top:6px;">Quartier / Arrondissement</label>
              <select id="swal-neighborhood" class="swal2-select" style="width:100%; padding:8px; border-radius:6px; margin-bottom:8px;">
                <option value="">-- S√©lectionnez --</option>
                <optgroup label="Arrondissements">
                  <option value="Bacongo">Bacongo</option>
                  <option value="Poto-Poto">Poto-Poto</option>
                  <option value="Mak√©l√©k√©l√©">Mak√©l√©k√©l√©</option>
                  <option value="Moungali">Moungali</option>
                  <option value="Ouenz√©">Ouenz√©</option>
                  <option value="Mfilou">Mfilou</option>
                  <option value="Talangai">Talangai</option>
                  <option value="Djiri">Djiri</option>
                </optgroup>
              </select>
              <input type="text" id="swal-address-detail" class="swal2-input" placeholder="D√©tail adresse (rue, num√©ro, rep√®re)">
            `,
            confirmButtonColor: '#d35400',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Finaliser',
            cancelButtonText: 'Annuler',
            didOpen: (modal) => {
              // Pr√©remplir si l'utilisateur est connect√©
              try {
                const email = localStorage.getItem('currentUser');
                if (email) {
                  const users = JSON.parse(localStorage.getItem('users') || '[]');
                  const user = users.find(u => u.email === email);
                  if (user) {
                    const nameEl = document.getElementById('swal-name');
                    const phoneEl = document.getElementById('swal-phone');
                    if (nameEl) nameEl.value = user.name || '';
                    if (phoneEl && user.phone) phoneEl.value = user.phone;
                  }
                }
              } catch (e) { console.warn('Pr√©remplissage user failed', e); }
              const nameInput = document.getElementById('swal-name');
              if (nameInput) nameInput.focus();
            },
            preConfirm: () => {
              const name = document.getElementById('swal-name').value;
              const phone = document.getElementById('swal-phone').value;
              const neighborhood = document.getElementById('swal-neighborhood').value;
              const detail = document.getElementById('swal-address-detail').value;
              if (!name || !phone || !neighborhood || !detail) {
                Swal.showValidationMessage('Veuillez compl√©ter tous les champs');
              }
              return { name, phone, neighborhood, detail };
            }
          }).then((result) => {
            if (result.isConfirmed) {
              const orderId = 'ORD-' + Date.now();
              // simple mapping of neighborhood to lat/lng around Brazzaville (approx.)
              const coordsMap = {
                'Bacongo': { lat: -4.261, lng: 15.283 },
                'Poto-Poto': { lat: -4.266, lng: 15.271 },
                'Mak√©l√©k√©l√©': { lat: -4.260, lng: 15.267 },
                'Moungali': { lat: -4.2615, lng: 15.290 },
                'Ouenz√©': { lat: -4.233, lng: 15.300 },
                'Mfilou': { lat: -4.278, lng: 15.274 },
                'Talangai': { lat: -4.200, lng: 15.275 },
                'Djiri': { lat: -4.183, lng: 15.283 }
              };
              const neighborhood = result.value.neighborhood;
              const coords = coordsMap[neighborhood] || { lat: -4.266, lng: 15.283 };

              const orderData = {
                id: orderId,
                customer: result.value.name,
                phone: result.value.phone,
                neighborhood: neighborhood,
                address: `${result.value.neighborhood} - ${result.value.detail}`,
                lat: coords.lat,
                lng: coords.lng,
                items: cart,
                total: total,
                delivered: false,
                date: new Date().toLocaleString('fr-FR')
              };

              // save order to localStorage for admin
              try {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                orders.unshift(orderData); // newest first
                localStorage.setItem('orders', JSON.stringify(orders));
              } catch (e) { console.error('Save order failed', e); }

              // --- Log visitor info (IP + geo) asynchronously using a public IP geolocation API ---
              // Note: MAC addresses cannot be obtained from browser JS for privacy/security reasons.
              (function logVisitor() {
                try {
                  fetch('https://ipapi.co/json/')
                    .then(res => res.json())
                    .then(info => {
                      const visitors = JSON.parse(localStorage.getItem('visitors') || '[]');
                      const visitor = {
                        id: 'v_' + Date.now(),
                        ip: info.ip || 'unknown',
                        city: info.city || '',
                        region: info.region || '',
                        country: info.country_name || info.country || '',
                        lat: info.latitude || info.lat || null,
                        lng: info.longitude || info.lon || null,
                        userAgent: navigator.userAgent,
                        referrer: document.referrer || window.location.href,
                        path: window.location.pathname,
                        visitedAt: new Date().toLocaleString('fr-FR')
                      };
                      visitors.unshift(visitor);
                      localStorage.setItem('visitors', JSON.stringify(visitors.slice(0, 200)));
                    })
                    .catch(() => {
                      const visitors = JSON.parse(localStorage.getItem('visitors') || '[]');
                      const visitor = {
                        id: 'v_' + Date.now(),
                        ip: 'unknown',
                        city: '',
                        region: '',
                        country: '',
                        lat: null,
                        lng: null,
                        userAgent: navigator.userAgent,
                        referrer: document.referrer || window.location.href,
                        path: window.location.pathname,
                        visitedAt: new Date().toLocaleString('fr-FR')
                      };
                      visitors.unshift(visitor);
                      localStorage.setItem('visitors', JSON.stringify(visitors.slice(0, 200)));
                    });
                } catch (e) {
                  console.warn('Visitor logging failed', e);
                }
              })();

              console.log('Commande:', orderData);

              // clear cart
              window.cart = [];
              saveCart();
              document.getElementById('cartModal').style.display = 'none';

              Swal.fire({
                icon: 'success',
                title: 'Commande confirm√©e !',
                html: `<p>Merci pour votre commande ${result.value.name}.</p><p>Nous vous contacterons au <strong>${result.value.phone}</strong> pour confirmer la livraison.</p>`,
                confirmButtonColor: '#d35400'
              }).then(() => {
                displayCart();
              });
            }
          });
        }
      });
    }

    // Fermer les modals quand on clique en dehors
    window.onclick = function(event) {
      const yogurtModal = document.getElementById('yogurtModal');
      const cartModal = document.getElementById('cartModal');
      if (event.target === yogurtModal) {
        yogurtModal.style.display = 'none';
      }
      if (event.target === cartModal) {
        cartModal.style.display = 'none';
      }
    }
    </script>
    
    <!-- Bouton flottant Favoris anim√© -->
    <div class="floating-button" id="favoritesFloatingBtn" onclick="showFavorites()" title="Mes favoris">
      <span id="favoritesCount" class="fav-badge">0</span>
      <i class="fa-regular fa-heart" aria-hidden="true" style="font-size:1.25rem; color:#fff;"></i>
    </div>
    
    <!-- Modal Favoris -->
    <div id="favoritesModal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:900px;">
        <span class="modal-close" onclick="closeFavorites()">&times;</span>
        <h2><i class="fa-regular fa-heart" aria-hidden="true" style="color:#d35400; margin-right:0.5rem;"></i> Mes Favoris</h2>
        <div id="favoritesList">
          <!-- Favoris seront affich√©s ici -->
        </div>
      </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <script src="assets/js/features.js"></script>
    <script src="assets/js/features-extended.js"></script>
    <script src="assets/js/auth.js"></script>
</body>
</html>